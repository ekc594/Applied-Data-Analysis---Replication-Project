---
title: "Working Rmd"
output: html_document
---
```{R}
knitr::opts_chunk$set(
    echo=TRUE,
    warning=FALSE,
    comment="##",
    prompt=FALSE,
    tidy=TRUE,
    tidy.opts=list(width.cutoff=75),
    fig.path="img/"
)
```

```{R}
install.packages("ape")
library(ape)
install.packages("caper")
library(caper)
library(ggplot2)
```

Importing/Formatting Phylogenetic Tree and Dataset
```{R}
trees3<-read.nexus("C:/Users/EmmaKristina/Desktop/tree.txt")
head(trees3)
summary(trees3)
tree<-trees3$mammalST_bestDates
tree
plot(tree)

data<-read.csv("C:/Users/EmmaKristina/Desktop/Heard-Booth&Kirk_2012_data.csv",header=TRUE,sep = ",")
head(data)
logBM<-log10(data$BM)
logAD<-log10(data$AD)
logMRS<-log10(data$MRS)
data<-data.frame(cbind(data,logBM,logAD,logMRS))
names(data)<-c("Order","Family","Genus.species","BM","AD","MRS","ACT","logBM","logAD","logMRS")
data$Genus.species<-gsub(" ", "_", data$Genus.species)
head(data)

species<-c("Aepyceros_melampus","Alcelaphus_buselaphus","Antilope_cervicapra","Bison_bison","Connochaetes_gnou","Hippotragus_equinus","Taurotragus_oryx","Alces_alces","Cervus_elaphus","Dama_dama","Odocoileus_hemionus","Odocoileus_virginianus","Giraffa_camelopardalis","Canis_lupus","Urocyon_cinereoargenteus","Vulpes_vulpes","Acinonyx_jubatus","Panthera_leo","Panthera_tigris","Crocuta_crocuta","Meles_meles","Procyon_lotor","Ursus_americanus","Ursus_arctos","Dasyurus_viverrinus","Didelphis_marsupialis","Didelphis_virginiana","Bettongia_penicillata","Lepus_californicus","Sylvilagus_audubonii","Diceros_bicornis","Equus_burchellii","Equus_caballus","Equus_zebra","Cebus_capucinus","Erythrocebus_patas","Gorilla_gorilla","Elephas_maximus","Loxodonta_africana","Microtus_pennsylvanicus","Peromyscus_maniculatus","Zapus_hudsonius","Erethizon_dorsatum","Myoxus_glis","Rattus_rattus","Marmota_monax","Sciurus_carolinensis","Sciurus_niger","Tamias_striatus","Tamiasciurus_hudsonicus") 
str(species)
pruned.tree<-drop.tip(tree,setdiff(tree$tip.label,species))
write.tree(pruned.tree)
plot(pruned.tree,cex = 0.7)
```


OLS and PGLS Regression Statistics
```{R}

myobject<- comparative.data(phy = tree, data = data, names.col = Genus.species, vcv = TRUE, na.omit = FALSE, warn.dropped = TRUE)

summary(myobject$dropped)

#Log10 Axial Eye Diameter ~ Log10 Max Running Speed
olsModel1<-lm(logAD~logMRS,data = data)
summary(olsModel1)

model.pgls1<-pgls(log10(AD)~log10(MRS), data = myobject, lambda='ML')
summary(model.pgls1)
model.pgls1$aic

##Plot of logAD ~ logMRS

as.factor(data$order)
str(data)
p1<-ggplot(data = data, aes(x = logMRS, y = logAD)) + geom_point(aes(color = factor(Order))) + scale_color_manual(values = c("blue", "pink","lightblue","lightblue","lightblue","green","gray","yellow","black","orange")) + geom_abline(slope = olsModel1$coefficients[2], intercept = olsModel1$coefficients[1], color = "black")+xlab("Log10 Maximum Running Speed")+ylab("Log10 Axial Eye Diameter") + geom_abline(slope=model.pgls1$model$coef[2],intercept = model.pgls1$model$coef[1], color="orange")
p1

#Log10 Axial Eye Diameter ~ Log10 Body Mass
olsModel2<-lm(logAD~logBM,data = data)
summary(olsModel2)

model.pgls2<-pgls(log10(AD)~log10(BM), data = myobject, lambda='ML')
summary(model.pgls2)
model.pgls2$aic

##Plot of logAD ~ logBM

p2<-ggplot(data = data, aes(x = logBM, y = logAD)) + geom_point(aes(color = factor(Order))) + scale_color_manual(values = c("blue", "pink","lightblue","lightblue","lightblue","green","gray","yellow","black","orange")) + geom_abline(slope = olsModel2$coefficients[2], intercept = olsModel2$coefficients[1], color = "black")+xlab("Log10 Body Mass")+ylab("Log10 Axial Eye Diameter") + geom_abline(slope=model.pgls2$model$coef[2],intercept = model.pgls2$model$coef[1], color="orange")
p2

#Log10 Max Running Speed ~ Log10 Body Mass

olsModel3<-lm(logMRS~logBM,data = data)
summary(olsModel3)

model.pgls3<-pgls(logMRS~logBM, data = myobject, lambda='ML')
summary(model.pgls3)
model.pgls3$aic

##Plot of logMRS ~ logBM

p3<-ggplot(data = data, aes(x = logBM, y = logMRS)) + geom_point(aes(color = factor(Order))) + scale_color_manual(values = c("blue", "pink","lightblue","lightblue","lightblue","green","gray","yellow","black","orange")) + geom_abline(slope = olsModel3$coefficients[2], intercept = olsModel3$coefficients[1], color = "black")+xlab("Log10 Body Mass")+ylab("Log10 Max Running Speed") + geom_abline(slope=model.pgls3$model$coef[2],intercept = model.pgls3$model$coef[1], color="orange")
p3

# MULTIPLE REGRESSION:

##Log10 Axial Eye Diameter ~ Log10 Body Mass + Log10 Max Running Speed

olsModel4<-lm(logAD~logBM+logMRS,data = data)
summary(olsModel4)

model.pgls4<-pgls(logAD~logBM+logMRS, data = myobject, lambda='ML')
summary(model.pgls4)
model.pgls4$aic

# PARTIAL REGRESSION (PGLS):

ADres<-model.pgls2$residuals
MRSres<-model.pgls3$residuals
data<-cbind(data,ADres,MRSres)
myobject_res<- comparative.data(phy = tree, data = data, names.col = Genus.species, vcv = TRUE, na.omit = FALSE, warn.dropped = TRUE)
summary(myobject_res$dropped)

##Residual Log10 Axial Eye Diameter ~ Residual Log10 Max Running Speed

model.pgls5<-pgls(ADres~MRSres, data = myobject_res, lambda='ML')
summary(model.pgls5)
model.pgls5$aic

p5<-ggplot(data = data, aes(x = MRSres, y = ADres)) + geom_point(aes(color = factor(Order))) + scale_color_manual(values = c("blue", "pink","lightblue","lightblue","lightblue","green","gray","yellow","black","orange"))+xlab("Max Running Speed Residuals")+ylab("Axial Eye Diameter Residuals") + geom_abline(slope=model.pgls5$model$coef[2],intercept = model.pgls5$model$coef[1], color="orange")
p5
```



















